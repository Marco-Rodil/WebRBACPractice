{% extends "base.html" %}
{% block content %}
  <h1>Hello, {{ current_user.username }}!</h1>
  {% for user in users %}
    {% if current_user.can_view(user)  %}
          <table style="border: 1px solid black;">
            <tr style="vertical-align: top;">
                <td><img src="{{ user.avatar(36) }}" alt="Profile Image"></td>
                <td>
                    <h3>User: {{ user.username }}</h3>
                    <h5>Role: {{ user.get_role_string() }}</h5>
                    {% if user.about_me %}<p>{{ user.about_me }}</p>{% endif %}
                    {% if user.last_seen %}<p>Last seen on: {{ user.last_seen }}</p>{% endif %}
                </td>
                {% if (current_user.role in [role.ADMIN, role.HR_MANAGER, role.EDITOR]) %}
                    <td>
                        <h3>Control Actions</h3>
                        <form method="post" action="">
                            {{ form.hidden_tag() }}
                                {% if (current_user.role == role.EDITOR) %}
                                <p>
                                    New {{ form.username.label }}<br>
                                    {{ form.username(size=32, readonly=True, placeholder=user.username) }}<br>
                                    <span style="color: dimgrey;">Not Authorized</span>
                                </p>
                                {% else %}
                                 <p>
                                    New {{ form.username.label }}<br>
                                    {{ form.username(size=32) }}<br>
                                    {% for error in form.username.errors %}
                                        <span style="color: red;">[{{ error }}]</span>
                                    {% endfor %}
                                </p>
                                {% endif %}

                                <p>
                                    {{ form.about_me.label }}<br>
                                    {{ form.about_me(cols=50, rows=4) }}<br>
                                    {% for error in form.about_me.errors %}
                                     <span style="color: red;">[{{ error }}]</span>
                                    {% endfor %}
                                </p>
                                {% if (current_user.role == role.EDITOR) %}
                                    <p>Change Role: {{ form.role(value=current_user.role, readonly=True) }}</p>
                                    <span style="color: dimgrey;">Not Authorized</span>
                                {% else %}
                                    <p>Change Role: {{ form.role }}</p>
                                {% endif %}
                                {% if current_user.role == role.ADMIN %}
                                    <p>{{ form.delete.label }} {{ form.delete }}</p>
                                {% endif %}
                                <p>
                                    {{ form.old_username(size=32, placeholder="Enter old username to confirm changes") }}
                                    {{ form.submit() }}
                                </p>
                        </form>
                    </td>
                {% endif %}
            </tr>
        </table>
      {% endif %}
  {% endfor %}
{% endblock %}